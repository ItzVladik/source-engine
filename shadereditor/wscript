#! /usr/bin/env python
# encoding: utf-8

from waflib import Utils
import os

top = '.'
PROJECT_NAME = 'shadereditor_2013'

def options(opt):
	# stub
	return

def configure(conf):
	conf.env.LINK = 'ld.lld'
	conf.env.append_unique('DEFINES',[
		'SHADER_EDITOR_DLL',
		'SHADER_EDITOR_DLL_2013',
		'NO_STRING_T',
		'CLIENT_DLL',
		'NO_COMPILING',
		'VECTOR',
		'strncpy=use_Q_strncpy_instead',
		'_snprintf=use_Q_snprintf_instead'
	])

def build(bld):
	source = [
			'chlsl_image.cpp',
			'chlsl_mesh.cpp',
			'chlsl_variable.cpp',
			'ckvpacker.cpp',
			'cregex.cpp',
			'editorcommon.cpp',
			'exported_utilities.cpp',
			'gdirectories.cpp',
			'gpostprocessingcache.cpp',
			'grendertargetconfig.cpp',
			'gshaderdumps.cpp',
			'vbasediag.cpp',
			'vbridge.cpp',
			'vdialogconfig.cpp',
			'vdialogeditorconfig.cpp',
			'vdialognew.cpp',
			'vdialogppeconfig.cpp',
			'vdialogppeffectprecache.cpp',
			'vdialogrecompileall.cpp',
			'vdialogrtlist.cpp',
			'vdialogsprecache.cpp',
			'veditorflowgraphpage.cpp',
			'veditorflowgraphsheet.cpp',
			'veditorroot.cpp',
			'vgui_init.cpp',
			'vjack.cpp',
			'vnodeview.cpp',
			'vnodeviewerror.cpp',
			'vpreview.cpp',
			'vrenderpanel.cpp',
			'util/client_factorylist.cpp',
			'util/igamesystem.cpp',
			'../public/collisionutils.cpp',
			'../vgui_editor/vgui_controls_editor.cpp',
			'../public/crtmemdebug.cpp',
			'interface/dll_init.cpp',
			'interface/editorinit.cpp',
			'interface/ppehelper.cpp',
			'../materialsystem/ivprocshader.cpp',
			'nodes/vbasecontainer.cpp',
			'nodes/vbasenode.cpp',
			'nodes/vnode_add.cpp',
			'nodes/vnode_array.cpp',
			'nodes/vnode_baseevaluate.cpp',
			'nodes/vnode_baserange.cpp',
			'nodes/vnode_break.cpp',
			'nodes/vnode_callback.cpp',
			'nodes/vnode_combo.cpp',
			'nodes/vnode_comment.cpp',
			'nodes/vnode_condition.cpp',
			'nodes/vnode_constant.cpp',
			'nodes/vnode_cross.cpp',
			'nodes/vnode_custom.cpp',
			'nodes/vnode_divide.cpp',
			'nodes/vnode_dot.cpp',
			'nodes/vnode_envc.cpp',
			'nodes/vnode_final.cpp',
			'nodes/vnode_flashlight.cpp',
			'nodes/vnode_fog.cpp',
			'nodes/vnode_lerp.cpp',
			'nodes/vnode_lightscale.cpp',
			'nodes/vnode_loop.cpp',
			'nodes/vnode_matrices.cpp',
			'nodes/vnode_mcompose.cpp',
			'nodes/vnode_multiply.cpp',
			'nodes/vnode_parallax.cpp',
			'nodes/vnode_psinput.cpp',
			'nodes/vnode_psoutput.cpp',
			'nodes/vnode_sampler.cpp',
			'nodes/vnode_std_plight.cpp',
			'nodes/vnode_std_skinning.cpp',
			'nodes/vnode_std_vlight.cpp',
			'nodes/vnode_subtract.cpp',
			'nodes/vnode_swizzle.cpp',
			'nodes/vnode_texsample.cpp',
			'nodes/vnode_textransform.cpp',
			'nodes/vnode_utility.cpp',
			'nodes/vnode_vcompression.cpp',
			'nodes/vnode_vecappend.cpp',
			'nodes/vnode_vectorref.cpp',
			'nodes/vnode_vmtparam.cpp',
			'nodes/vnode_vsinput.cpp',
			'nodes/vnode_vsoutput.cpp',
			'nodes/postprocessing/vnode_pp_base.cpp',
			'nodes/postprocessing/vnode_pp_drawmat.cpp',
			'nodes/postprocessing/vnode_pp_mat.cpp',
			'nodes/postprocessing/vnode_pp_operations.cpp',
			'nodes/postprocessing/vnode_pp_renderview.cpp',
			'nodes/postprocessing/vnode_pp_rt.cpp',
			'properties/vcodeeditor.cpp',
			'properties/vnodeproperties.cpp',
			'properties/vsheet_array.cpp',
			'properties/vsheet_base.cpp',
			'properties/vsheet_callback.cpp',
			'properties/vsheet_cmatrix.cpp',
			'properties/vsheet_combo.cpp',
			'properties/vsheet_comment.cpp',
			'properties/vsheet_condition.cpp',
			'properties/vsheet_constant.cpp',
			'properties/vsheet_custom.cpp',
			'properties/vsheet_final.cpp',
			'properties/vsheet_flashlight.cpp',
			'properties/vsheet_general.cpp',
			'properties/vsheet_lightscale.cpp',
			'properties/vsheet_loop.cpp',
			'properties/vsheet_mcomp.cpp',
			'properties/vsheet_multiply.cpp',
			'properties/vsheet_parallax.cpp',
			'properties/vsheet_psoutput.cpp',
			'properties/vsheet_stdplight.cpp',
			'properties/vsheet_stdpspeclight.cpp',
			'properties/vsheet_stdskinning.cpp',
			'properties/vsheet_stdvlight.cpp',
			'properties/vsheet_swizzle.cpp',
			'properties/vsheet_textransform.cpp',
			'properties/vsheet_texturesample.cpp',
			'properties/vsheet_vcompression.cpp',
			'properties/vsheet_vmtparam.cpp',
			'properties/vsheet_vsinput.cpp',
			'properties/vsheet_vsoutpsin.cpp',
			'properties/postprocessing/vsheet_pp_drawmat.cpp',
			'properties/postprocessing/vsheet_pp_mat.cpp',
			'properties/postprocessing/vsheet_pp_operations.cpp',
			'properties/postprocessing/vsheet_pp_renderview.cpp',
			'properties/postprocessing/vsheet_pp_rt.cpp',
			'properties/smarttext/vsmartautocomplete.cpp',
			'properties/smarttext/vsmartobject.cpp',
			'properties/smarttext/vsmartobjectlist.cpp',
			'properties/smarttext/vsmartrow.cpp',
			'properties/smarttext/vsmarttext.cpp',
			'properties/smarttext/vsmarttooltip.cpp',
			'solver/chlsl_solver_add.cpp',
			'solver/chlsl_solver_append.cpp',
			'solver/chlsl_solver_array.cpp',
			'solver/chlsl_solver_baseevaluate.cpp',
			'solver/chlsl_solver_baserange.cpp',
			'solver/chlsl_solver_break.cpp',
			'solver/chlsl_solver_callback.cpp',
			'solver/chlsl_solver_constant.cpp',
			'solver/chlsl_solver_containerbasic.cpp',
			'solver/chlsl_solver_cross.cpp',
			'solver/chlsl_solver_custom.cpp',
			'solver/chlsl_solver_divide.cpp',
			'solver/chlsl_solver_dot.cpp',
			'solver/chlsl_solver_dummy.cpp',
			'solver/chlsl_solver_envc.cpp',
			'solver/chlsl_solver_final.cpp',
			'solver/chlsl_solver_flashlight.cpp',
			'solver/chlsl_solver_fog.cpp',
			'solver/chlsl_solver_lerp.cpp',
			'solver/chlsl_solver_lightscale.cpp',
			'solver/chlsl_solver_matrices.cpp',
			'solver/chlsl_solver_mcomp.cpp',
			'solver/chlsl_solver_multiply.cpp',
			'solver/chlsl_solver_parallax.cpp',
			'solver/chlsl_solver_readsemantics.cpp',
			'solver/chlsl_solver_stdplight.cpp',
			'solver/chlsl_solver_stdskinning.cpp',
			'solver/chlsl_solver_stdvlight.cpp',
			'solver/chlsl_solver_subtract.cpp',
			'solver/chlsl_solver_swizzle.cpp',
			'solver/chlsl_solver_textransform.cpp',
			'solver/chlsl_solver_texturesample.cpp',
			'solver/chlsl_solver_utility.cpp',
			'solver/chlsl_solver_vcompression.cpp',
			'solver/chlsl_solver_vecref.cpp',
			'solver/chlsl_solver_vmtparam.cpp',
			'solver/chlsl_solver_writesemantics.cpp',
			'solver/chlsl_solverbase.cpp',
			'solver/postprocessing/chlsl_solver_pp_drawmat.cpp',
			'solver/postprocessing/chlsl_solver_pp_mat.cpp',
			'solver/postprocessing/chlsl_solver_pp_operations.cpp',
			'solver/postprocessing/chlsl_solver_pp_renderview.cpp',
			'solver/postprocessing/chlsl_solver_pp_rt.cpp',
			'solver/postprocessing/chlsl_solverpp_base.cpp',
			'threads/cbasethread.cpp',
			'threads/ccompilethread.cpp',
			'threads/csolvercallback.cpp',
			'threads/cthreadmanager.cpp',
	]

	includes = [
		'.',
		'interface',
		'util',
		'interface',
		'nodes',
		'properties',
		'solver',
		'threads',
		'solver/postprocessing',
		'properties/postprocessing',
		'properties/smarttext',
		'nodes/postprocessing',
		'vgui_controls_editor',
		'../public',
		'../public/tier1',
		'../public/tier0',
		'../common',
		'../shadereditor',
		'../materialsystem',
		'../game/client/shadereditor',
	]

	defines = []

	libs = [
		'tier0',
		'particles',
		'dmxloader',
		'mathlib',
		'vtf',
		'matsys_controls',
		'tier1',
		'tier2',
		'tier3',
		'vgui_controls_editor',
		'vgui2',
		'vstdlib',
		'choreoobjects',
		'steam_api',
		'bitmap',
		'RT',
		'ZLIB',
		'JPEG',
		'boost_regex',
	]
	
	if bld.env.DEST_OS == 'win32':
		libs += ['RPCRT4']
	elif bld.env.DEST_OS == "darwin":
		libs += ['ICONV']
		
	bld.shlib(
		source   = source,
		target   = PROJECT_NAME,
		name     = PROJECT_NAME,
		features = 'c cxx',
		includes = includes,
		defines  = defines,
		use      = libs,
		subsystem = bld.env.MSVC_SUBSYSTEM,
		idx      = bld.get_taskgen_count()
	)

